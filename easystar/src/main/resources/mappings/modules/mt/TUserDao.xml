<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.thinkgem.jeesite.modules.mt.dao.TUserDao">
    
	<sql id="tUserColumns">
		a.id AS "id",
		a.t_userid AS "tUserid",
		a.t_loginname AS "tLoginname",
		a.t_name AS "tName",
		a.t_email AS "tEmail",
		a.t_phone AS "tPhone",
		a.qq AS "qq",
		a.wx AS "wx",
		a.t_photourl AS "tPhotourl",
		a.t_photoinfo AS "tPhotoinfo",
		a.t_company AS "tCompany",
		a.t_companyurl AS "tCompanyurl",
		a.createtime AS "createtime",
		a.t_acount AS "tAcount",
		a.t_inviter AS "tInviter",
		a.reserve1 AS "reserve1",
		a.reserve2 AS "reserve2",
		a.reserve3 AS "reserve3",
		a.reserve4 AS "reserve4",
		a.reserve5 AS "reserve5",
		a.create_by AS "createBy.id",
		a.create_date AS "createDate",
		a.update_by AS "updateBy.id",
		a.update_date AS "updateDate",
		a.remarks AS "remarks",
		a.del_flag AS "delFlag"
	</sql>
	
	<sql id="tUserJoins">
	</sql>
    
	<select id="get" resultType="TUser">
		SELECT 
			<include refid="tUserColumns"/>
		FROM t_user a
		<include refid="tUserJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="TUser">
		SELECT 
			<include refid="tUserColumns"/>
		FROM t_user a
		<include refid="tUserJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="tLoginname !=null and tLoginname !=''">
				and a.t_loginname=#{tLoginname}
			</if>
			<if test="tName !=null and tName !=''">
				and a.t_name=#{tName}
			</if>
			<if test="tPhone !=null and tPhone !=''">
				and a.t_phone=#{tPhone}
			</if>
			<if test="tUserid !=null and tUserid !=''">
				and a.t_userid=#{tUserid}
			</if>
			<if test="tInviter !=null and tInviter !=''">
				and a.t_inviter=#{tInviter}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllList" resultType="TUser">
		SELECT 
			<include refid="tUserColumns"/>
		FROM t_user a
		<include refid="tUserJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO t_user(
			id,
			t_userid,
			t_loginname,
			t_name,
			t_email,
			t_phone,
			qq,
			wx,
			t_photourl,
			t_photoinfo,
			t_company,
			t_companyurl,
			createtime,
			t_inviter,
			reserve1,
			reserve2,
			reserve3,
			reserve4,
			reserve5,
			create_by,
			create_date,
			update_by,
			update_date,
			remarks,
			del_flag
		) VALUES (
			#{id},
			#{tUserid},
			#{tLoginname},
			#{tName},
			#{tEmail},
			#{tPhone},
			#{qq},
			#{wx},
			#{tPhotourl},
			#{tPhotoinfo},
			#{tCompany},
			#{tCompanyurl},
			now(),
			#{tInviter},
			#{reserve1},
			#{reserve2},
			#{reserve3},
			#{reserve4},
			#{reserve5},
			#{createBy.id},
			#{createDate},
			#{updateBy.id},
			#{updateDate},
			#{remarks},
			#{delFlag}
		)
	</insert>
	
	<update id="update">
		UPDATE t_user SET 	
			t_userid = #{tUserid},
			t_loginname = #{tLoginname},
			t_name = #{tName},
			t_email = #{tEmail},
			t_phone = #{tPhone},
			qq = #{qq},
			wx = #{wx},
			t_photourl = #{tPhotourl},
			t_photoinfo = #{tPhotoinfo},
			t_company = #{tCompany},
			t_companyurl = #{tCompanyurl},
			createtime = now(),
			t_inviter = #{tInviter},
			reserve1 = #{reserve1},
			reserve2 = #{reserve2},
			reserve3 = #{reserve3},
			reserve4 = #{reserve4},
			reserve5 = #{reserve5},
			update_by = #{updateBy.id},
			update_date = #{updateDate},
			remarks = #{remarks}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		UPDATE t_user SET 
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>
	
	<!-- 通过登录名获取当前用户在t_user表中的数据 -->
	<select id="getUserByLoginName" resultType="TUser">
		SELECT 
			<include refid="tUserColumns"/>
		FROM t_user a
		<include refid="tUserJoins"/>
		WHERE a.t_userid = #{loginName}
	</select>
	
	<!-- 通过登录用户名修改t_user表中的数据 -->
	<update id="updUser" parameterType="TUser">
		update t_user set 
		t_email = #{tEmail},
		t_phone = #{tPhone},
		qq = #{qq},
		wx = #{wx},
		t_company = #{tCompany},
		t_companyurl = #{tCompanyurl},
		createtime=now()
		where t_loginname = #{tLoginname}
	</update>
	
	<!-- 更新sys_user中的数据通过登录名 -->
	<update id="updSysUser" parameterType="TUser">
		update sys_user set 
		email = #{tEmail},
		phone = #{tPhone},
		mobile = #{tPhone}
		where login_name = #{tLoginname}
	</update>
	
	<!-- 通过登录用户名获取密码 -->
	<select id="getPassword" resultType="java.lang.String">
		select password from sys_user where login_name=#{loginName}
	</select>
	
	<!-- 通过当前登录的手机号标识获取自己已邀请多少人 -->
	<select id="getcountbyinviter" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(1) as count from t_user where t_inviter=#{tPhone}
	</select>
	
	<!-- 这个是保存二维码地址的操作--> 
	<insert id="addpicturecode" parameterType="java.util.Map">
		insert into t_erweimacode(
		id,
		te_codeurl,
		te_codeinfo
		)values(
		#{id},
		#{pathName},
		#{phone}
		)
	</insert>
	
	<!-- 通过手机号获取用户名密码 -->
	<select id="getTUserByPhone" resultType="TUser">
		select t_loginname as tLoginname,reserve1 from t_user where t_phone=#{tPhone}
	</select>
	
	<!-- 检查用户名是否已经存在了 -->
	<select id="checkusername" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(1) as count from t_user where t_loginName=#{username}
	</select>
	
	<!-- 检查手机号是否已经存在了 -->
	<select id="checkphone" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(1) as count from t_user where t_phone=#{phone}
	</select>
</mapper>